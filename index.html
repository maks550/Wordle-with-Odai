import pygame
import sys
import random
import time

pygame.init()

WIDTH, HEIGHT = pygame.display.Info().current_w, pygame.display.Info().current_h
TILE_SIZE = 40
ROWS = HEIGHT // TILE_SIZE
COLS = WIDTH // TILE_SIZE

BLACK = (0, 0, 0)
YELLOW = (255, 255, 0)
BLUE = (0, 0, 255)
WHITE = (255, 255, 255)

screen = pygame.display.set_mode((WIDTH, HEIGHT), pygame.FULLSCREEN)
pygame.display.set_caption("Pacman Clone")
clock = pygame.time.Clock()

font = pygame.font.SysFont("Arial", 36)
large_font = pygame.font.SysFont("Arial", 120, bold=True)

maze = [[1 if x == 0 or y == 0 or x == COLS - 1 or y == ROWS - 1 else 0 for x in range(COLS)] for y in range(ROWS)]
for i in range(100):
    x, y = random.randint(1, COLS - 2), random.randint(1, ROWS - 2)
    maze[y][x] = 1

dots = [(x, y) for y in range(ROWS) for x in range(COLS) if maze[y][x] == 0]

player_x, player_y = 1, 1
score = 0
start_game = False
countdown = 3

direction = None

start_button = pygame.Rect(WIDTH//2 - 100, HEIGHT//2 - 50, 200, 100)

def draw_maze():
    for y in range(ROWS):
        for x in range(COLS):
            if maze[y][x] == 1:
                pygame.draw.rect(screen, BLUE, (x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE))

def draw_dots():
    for x, y in dots:
        pygame.draw.circle(screen, WHITE, (x * TILE_SIZE + TILE_SIZE // 2, y * TILE_SIZE + TILE_SIZE // 2), 5)

def draw_player():
    pygame.draw.circle(screen, YELLOW, (player_x * TILE_SIZE + TILE_SIZE // 2, player_y * TILE_SIZE + TILE_SIZE // 2), TILE_SIZE // 2 - 2)

def draw_start_screen():
    pygame.draw.rect(screen, BLUE, start_button)
    text = font.render("СТАРТ", True, WHITE)
    screen.blit(text, (WIDTH//2 - text.get_width()//2, HEIGHT//2 - text.get_height()//2))

def draw_countdown(c):
    text = large_font.render(str(c), True, WHITE)
    screen.blit(text, (WIDTH//2 - text.get_width()//2, HEIGHT//2 - text.get_height()//2))

def draw_credits():
    text1 = font.render("Розробники:", True, WHITE)
    text2 = font.render("Максим Ткачук і Лукань Михайло", True, WHITE)
    screen.blit(text1, (WIDTH//2 - text1.get_width()//2, HEIGHT//2 - 40))
    screen.blit(text2, (WIDTH//2 - text2.get_width()//2, HEIGHT//2 + 10))

running = True

game_end = False
while running:
    clock.tick(10)
    screen.fill(BLACK)

    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            pygame.quit()
            sys.exit()
        elif not start_game and event.type == pygame.MOUSEBUTTONDOWN:
            if start_button.collidepoint(event.pos):
                for i in range(countdown, 0, -1):
                    screen.fill(BLACK)
                    draw_countdown(i)
                    pygame.display.flip()
                    time.sleep(1)
                start_game = True
        elif start_game and event.type == pygame.FINGERMOTION:
            dx = event.dx
            dy = event.dy
            if abs(dx) > abs(dy):
                direction = 'left' if dx < 0 else 'right'
            else:
                direction = 'up' if dy < 0 else 'down'

    if not start_game:
        draw_start_screen()
    elif game_end:
        draw_credits()
    else:
        new_x, new_y = player_x, player_y
        if direction == 'left':
            new_x -= 1
        elif direction == 'right':
            new_x += 1
        elif direction == 'up':
            new_y -= 1
        elif direction == 'down':
            new_y += 1

        if maze[new_y][new_x] == 0:
            player_x, player_y = new_x, new_y

        if (player_x, player_y) in dots:
            dots.remove((player_x, player_y))
            score += 1

        if not dots:
            game_end = True

        draw_maze()
        draw_dots()
        draw_player()

        score_text = font.render(f"Score: {score}", True, WHITE)
        screen.blit(score_text, (10, 10))

    pygame.display.flip()
                  
